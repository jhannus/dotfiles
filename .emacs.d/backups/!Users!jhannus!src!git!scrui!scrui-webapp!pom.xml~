<project xmlns="http://maven.apache.org/POM/4.0.0" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
  xsi:schemaLocation="http://maven.apache.org/POM/4.0.0 http://maven.apache.org/maven-v4_0_0.xsd">

  <parent>
    <groupId>com.constantcontact.apps.smm.rails</groupId>
    <artifactId>scrui-rails</artifactId>
    <version>0.0.1.0-development-SNAPSHOT</version>
  </parent>

  <modelVersion>4.0.0</modelVersion>
  <groupId>com.constantcontact.apps.smm.rails</groupId>
  <artifactId>scrui-webapp</artifactId>
  <version>0.0.1.0-development-SNAPSHOT</version>
  <name>scrui-webapp</name>
  <packaging>pom</packaging>
  <description>Social Campaigns Landing Pages app on Rails</description>
  
  <dependencies>
    <dependency>
      <groupId>com.constantcontact.third-party.cyberark</groupId>
      <artifactId>javapasswordsdk</artifactId>
      <version>1.0</version>
    </dependency>
    <dependency>
      <groupId>javax.servlet</groupId>
      <artifactId>servlet-api</artifactId>
      <version>2.5</version>
    </dependency>
    <dependency>
      <groupId>org.jruby.plugins</groupId>
      <artifactId>jruby-rake-plugin</artifactId>
      <version>1.6.7</version>
    </dependency>
    <dependency>
      <groupId>com.constantcontact.components</groupId>
      <artifactId>ccSecurity</artifactId>
      <version>1.0.0-SNAPSHOT</version>
    </dependency>
    <dependency>
      <groupId>log4j</groupId>
      <artifactId>log4j</artifactId>
      <version>1.2.14</version>        
    </dependency>  
    <dependency>
      <groupId>commons-codec</groupId>
      <artifactId>commons-codec</artifactId>
      <version>1.4</version>
    </dependency>
    <dependency>
      <groupId>com.constantcontact.components</groupId>
      <artifactId>ccCommon</artifactId>
      <version>2012.3-SNAPSHOT</version>
    </dependency>
    <dependency>
      <groupId>com.constantcontact.components</groupId>
      <artifactId>cclogging</artifactId>
      <version>2012.2-SNAPSHOT</version>
    </dependency>
  </dependencies>

  <build>
    <plugins>
      <plugin>
        <groupId>org.jruby.plugins</groupId>
        <artifactId>jruby-rake-plugin</artifactId>
        <version>1.6.7</version>
        <executions>
          <execution>
            <id>Install bundler gem</id>
            <phase>initialize</phase>
            <goals>
              <goal>jruby</goal>
            </goals>
            <configuration>
              <args>--1.9 -S gem install bundler --no-ri --no-rdoc -v 1.0.22</args>
            </configuration>
          </execution>

          <execution>
            <id>Install the app gem bundle</id>
            <phase>generate-sources</phase>
            <goals>
              <goal>jruby</goal>
            </goals>
            <configuration>
              <args>--1.9 -S bundle install</args>
            </configuration>
          </execution>

          <execution>
            <id>Assets precompile</id>
            <phase>compile</phase>
            <goals>
              <goal>jruby</goal>
            </goals>
            <configuration>
              <args> -S rake assets:precompile RAILS_ENV=${rails.env}</args>
            </configuration>
          </execution>

          <execution>
            <id>Build war and zip</id>
            <phase>package</phase>
            <goals>
              <goal>jruby</goal>
            </goals>
            <configuration>
              <args>--1.9 -S rake maven:war[${project.artifactId}] RAILS_ENV=${rails.env}</args>
            </configuration>
          </execution>
	    
	    <execution>
	        <id>Execute rspec tests</id>
		  <phase>test</phase>
		    <goals>
		        <goal>jruby</goal>
		    </goals>
		      <configuration>
			  <args>--1.9 -S rake spec</args>
		      </configuration>
	    </execution>
        </executions>
      </plugin>
      
      <plugin>
        <groupId>org.apache.maven.plugins</groupId>
        <artifactId>maven-dependency-plugin</artifactId>
        <executions>
          <execution>
            <id>copy dependencies</id>
            <goals>
              <goal>copy</goal>
            </goals>
            <configuration>
              <artifactItems>
                <artifactItem>
                  <groupId>com.constantcontact.third-party.cyberark</groupId>
                  <artifactId>javapasswordsdk</artifactId>
                  <type>jar</type>
                  <overWrite>true</overWrite>
                  <outputDirectory>${basedir}/lib</outputDirectory>
                  <destFileName>javapasswordsdk.jar</destFileName>
                </artifactItem>
                <artifactItem>
                  <groupId>com.constantcontact.components</groupId>
                  <artifactId>ccSecurity</artifactId>
                  <type>jar</type>
                  <overWrite>true</overWrite>
                  <outputDirectory>${basedir}/lib</outputDirectory>
                  <destFileName>ccSecurity.jar</destFileName>
                </artifactItem>
                <artifactItem>
                  <groupId>log4j</groupId>
                  <artifactId>log4j</artifactId>
                  <version>1.2.14</version>        
                  <overWrite>true</overWrite>
                  <outputDirectory>${basedir}/lib</outputDirectory>
                  <destFileName>log4j-1.2.14.jar</destFileName>
                </artifactItem>
                <artifactItem>
                  <groupId>commons-codec</groupId>
                  <artifactId>commons-codec</artifactId>
                  <version>1.4</version>
                  <overWrite>true</overWrite>
                  <outputDirectory>${basedir}/lib</outputDirectory>             
                  <destFileName>commons-codec-1.4.jar</destFileName>
                </artifactItem>
                <artifactItem>
                  <groupId>com.constantcontact.components</groupId>
                  <artifactId>cclogging</artifactId>
                  <version>2012.2-SNAPSHOT</version>
                  <overWrite>true</overWrite>
                  <outputDirectory>${basedir}/lib</outputDirectory>             
                  <destFileName>cclogging.jar</destFileName>
                </artifactItem>
                <artifactItem>
                  <groupId>com.constantcontact.components</groupId>
                  <artifactId>ccCommon</artifactId>
                  <version>2012.3-SNAPSHOT</version>
                  <overWrite>true</overWrite>
                  <outputDirectory>${basedir}/lib</outputDirectory>             
                  <destFileName>ccCommon.jar</destFileName>
                </artifactItem>
              </artifactItems>
            </configuration>
          </execution>
        </executions>
      </plugin>
      
      <plugin>
        <artifactId>maven-install-plugin</artifactId>
        <executions>
          <execution>
            <id>install scrui-webapp</id>
            <goals>
              <goal>install-file</goal>
            </goals>
            <phase>install</phase>
            <configuration>
              <file>${project.build.directory}/${project.artifactId}.war</file>
              <groupId>${project.groupId}</groupId>
              <artifactId>${project.artifactId}</artifactId>
              <version>${project.version}</version>
              <packaging>war</packaging>
            </configuration>
          </execution>
        </executions>
      </plugin>
      
      <plugin>
        <groupId>org.apache.maven.plugins</groupId>
        <artifactId>maven-deploy-plugin</artifactId>
        <executions>
          <execution>
            <id>deploy scrui-webapp</id>
            <goals>
              <goal>deploy-file</goal>
            </goals>
            <phase>deploy</phase>
            <configuration>
              <skip>true</skip>
              <uniqueVersion>true</uniqueVersion>
              <repositoryId>snapshots</repositoryId>
              <file>${project.build.directory}/${project.artifactId}.war</file>
              <groupId>${project.groupId}</groupId>
              <artifactId>${project.artifactId}</artifactId>
              <version>${project.version}</version>
              <packaging>war</packaging>
              <url>${project.distributionManagement.snapshotRepository.url}</url>
            </configuration>
          </execution>
        </executions>
      </plugin>
      
      <plugin>
        <groupId>org.apache.maven.plugins</groupId>
          <artifactId>maven-clean-plugin</artifactId>
          <configuration>
            <filesets>
              <fileset>
                <directory>tmp</directory>
              </fileset>
              <fileset>
                <directory>public/assets</directory>
              </fileset>
              <fileset>
                <directory>lib</directory>
                <includes>
                  <include>*.jar</include>
                </includes>
              </fileset>
              <fileset>
                <directory>log</directory>
                <includes>
                  <include>*.log</include>
                </includes>
              </fileset>
            </filesets>
          </configuration>
      </plugin>
      
        <plugin>
          <groupId>org.mortbay.jetty</groupId>
          <artifactId>jetty-maven-plugin</artifactId>
          <version>7.2.2.v20101205</version>
          <configuration>
            <stopKey>STOP</stopKey>
            <stopPort>8093</stopPort>
            <!-- scanIntervalSeconds=0 disables automatic reload -->
            <scanIntervalSeconds>10</scanIntervalSeconds>
            <webApp>${basedir}/target/${project.artifactId}.war</webApp>
            <systemProperties>
              <systemProperty>
                <name>log4j.configuration</name>
                <value>file:${basedir}/etc/log4j.properties</value>
              </systemProperty>
              <systemProperty>
                <name>slf4j</name>
                <value>false</value>
              </systemProperty>
            </systemProperties>
            <connectors>
              <connector implementation="org.eclipse.jetty.server.nio.SelectChannelConnector">
                <port>8080</port>
                <maxIdleTime>30000</maxIdleTime>
              </connector>
              <connector implementation="org.eclipse.jetty.server.ssl.SslSelectChannelConnector">
                <port>8443</port>
                <maxIdleTime>30000</maxIdleTime>
                <keystore>${basedir}/etc/keystore</keystore>
                <password>password</password>
                <keyPassword>password</keyPassword>
                <includeCipherSuites>
                  <includeCipherSuite>TLS_DHE_DSS_WITH_AES_128_CBC_SHA</includeCipherSuite>
                  <includeCipherSuite>TLS_DHE_RSA_WITH_AES_128_CBC_SHA</includeCipherSuite>
                  <includeCipherSuite>TLS_RSA_WITH_AES_128_CBC_SHA</includeCipherSuite>
                  <includeCipherSuite>TLS_DHE_DSS_WITH_AES_256_CBC_SHA</includeCipherSuite>
                  <includeCipherSuite>TLS_DHE_RSA_WITH_AES_256_CBC_SHA</includeCipherSuite>
                  <includeCipherSuite>TLS_RSA_WITH_AES_256_CBC_SHA</includeCipherSuite>
                </includeCipherSuites>
              </connector>
            </connectors>
          </configuration>
          <dependencies>
            <dependency>
              <groupId>log4j</groupId>
              <artifactId>log4j</artifactId>
              <version>1.2.15</version>
            </dependency>
          </dependencies>
        </plugin>
	  
	<!--plugin>
	<groupId>org.codehaus.mojo</groupId>
	<artifactId>rspec-maven-plugin-ctct</artifactId>
	<version>1.0-beta-13</version>
	<configuration>
	  <jrubyHome>${env.JRUBY_HOME}</jrubyHome>
	  <compatVersion>1.9</compatVersion>
	  <sourceDirectory>${basedir}/spec/lib</sourceDirectory>
	  <outputDirectory>${basedir}/target</outputDirectory>
	  <systemProperties>
	    <property><name>NPEfix</name><value>this fixes an NPE in the rspec plugin expecting at least one property</value></property>
	  </systemProperties>
	</configuration>
	<executions>
	  <execution>
	    <id>test</id>
	    <phase>test</phase>
	    <goals>
	      <goal>spec</goal>
	    </goals>
	  </execution>
	</executions>
      </plugin-->
	   
      </plugins>
    </build>
  
  <profiles>
    <profile>
      <id>rpm</id>
      <activation>
        <property>
          <name>rpm</name>
          <value>true</value>
        </property>
      </activation>
      <build>
        <plugins>
        </plugins>
      </build>
    </profile>
  </profiles>
  
</project>
